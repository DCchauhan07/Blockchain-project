<%- include partials/header.ejs %>

<body style="background: #abbaab;  /* fallback for old browsers */
background: -webkit-linear-gradient(to right, #ffffff, #abbaab);  /* Chrome 10-25, Safari 5.1-6 */
background: linear-gradient(to right, #ffffff, #abbaab); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */">

<body>
    <div class="container">
        <div class="row mt-5">
            <div class="col-md-6 offset-md-3">
                <div id="readArea" class="text-center">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/MetaMask_Fox.svg/1200px-MetaMask_Fox.svg.png" alt="MetaMask Logo" style="width: 100px; height: 100px;">
                    <h2 class="mt-3">Connect to MetaMask</h2>
                    <button class="btn btn-success mt-3" onclick="connectMetamask()">CONNECT TO METAMASK</button>
                    <p id="userArea" class="mt-3 text-muted">Status: Not connected to MetaMask</p>
                </div>
            </div>
        </div>
    </div>

    <div id="productList" class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-4">
                <div class="card">
                    <img src="https://insanelygoodrecipes.com/wp-content/uploads/2023/06/Cappuccino-Coffee-in-a-White-Cup.jpg" class="card-img-top" alt="Product 1">
                    <div class="card-body">
                        <h5 class="card-title">Cappuccino</h5>
                        <p class="card-text">A classic coffee drink made with equal parts brewed coffee and steamed milk.the perfect balance of espresso, steamed milk and foam.</p>
                        <p class="card-text"><strong>Price: 0.40Eth</strong></p>
                        <button onclick="buyProduct(1)" class="btn btn-primary">Buy Now</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <img src="https://coffeeaffection.com/wp-content/uploads/2021/05/Chocolate-frappe-coffee_Elena-Veselova_shutterstock.jpg" class="card-img-top" alt="Product 2">
                    <div class="card-body">
                        <h5 class="card-title">Frappuccino</h5>
                        <p class="card-text">A Frappuccino is a trademarked blended coffee beverage.</p>
                        <p class="card-text"><strong>Price: 0.70Eth</strong></p>
                        <button onclick="buyProduct(2)" class="btn btn-primary">Buy Now</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <img src="https://bunners.ca/cdn/shop/files/IMG_7051BlackBGGothicRainbowCakeWhole_2048x2048.jpg?v=1698853616" class="card-img-top" alt="Product 3">
                    <div class="card-body">
                        <h5 class="card-title">Cake</h5>
                        <p class="card-text">A rainbow cake is a vibrant and visually stunning dessert.</p>
                        <p class="card-text"><strong>Price: 0.60Eth</strong></p>
                        <button onclick="buyProduct(3)" class="btn btn-primary">Buy Now</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-md-4">
                <div class="card">
                    <img src="https://img.cake24x7.com/writable/apps/cake24x7/ProductGallery/5969/Mouth-Watering-Chocolate-Pastry---6-Pcs.jpg" class="card-img-top" alt="Product 4">
                    <div class="card-body">
                        <h5 class="card-title">Chocolate Pastry</h5>
                        <p class="card-text">A chocolate pastry is a delectable dessert that features a rich and indulgent chocolate flavor wrapped in a flaky, buttery pastry.</p>
                        <p class="card-text"><strong>Price: 0.80Eth</strong></p>
                        <button onclick="buyProduct(4)" class="btn btn-primary">Buy Now</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <img src="https://www.thespruceeats.com/thmb/aoQd_AmdGA2O1jHp5lCXrrZjfi4=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/how-to-make-masala-chai-tea-4134710-step-05-1-d3f31d2f583743459275556b2c33b806.jpg" class="card-img-top" alt="Product 5">
                    <div class="card-body">
                        <h5 class="card-title">Tea</h5>
                        <p class="card-text">Masala tea, also known as chai Indian beverage cherished for its aromatic blend of spices combined with rich black tea.</p>
                        <p class="card-text"><strong>Price: 0.90Eth</strong></p>
                        <button onclick="buyProduct(5)" class="btn btn-primary">Buy Now</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <img src="https://www.foodandwine.com/thmb/CCe2JUHfjCQ44L0YTbCu97ukUzA=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/Partners-Latte-FT-BLOG0523-09569880de524fe487831d95184495cc.jpg" class="card-img-top" alt="Product 6">
                    <div class="card-body">
                        <h5 class="card-title">Latte</h5>
                        <p class="card-text">A latte or caff√® latte is a milk coffee that is a made up of one or two shots of espresso, steamed milk and frothed milk on top.</p>
                        <p class="card-text"><strong>Price: 0.50Eth</strong></p>
                        <button onclick="buyProduct(6)" class="btn btn-primary">Buy Now</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-md-4">
                <div class="card">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTdfZyNS4AfLRaybgzL_27NywMHtV3wdbvvvU0ap54PnA&s" class="card-img-top" alt="Product 7">
                    <div class="card-body">
                        <h5 class="card-title">Masala Tea</h5>
                        <p class="card-text">Masala tea, also known as chai, is a popular Indian beverage and blend of spices.</p>
                        <p class="card-text"><strong>Price: 0.30Eth</strong></p>
                        <button onclick="buyProduct(7)" class="btn btn-primary">Buy Now</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <img src="https://imgcdn.floweraura.com/cover%20image.png" class="card-img-top" alt="Product 8">
                    <div class="card-body">
                        <h5 class="card-title">Blackcurrant Pastry</h5>
                        <p class="card-text">A blackcurrant pastry is a delightful sweet treat that typically features a buttery, flaky pastry filled with a luscious blackcurrant filling.</p>
                        <p class="card-text"><strong>Price: 0.70Eth</strong></p>
                        <button onclick="buyProduct(8)" class="btn btn-primary">Buy Now</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <img src="https://p.turbosquid.com/ts-thumb/Q0/iYJeTc/sA/ferochercakeslice/jpg/1676077186/1920x1080/turn_fit_q99/b96ac39062bbb3aa80628839fdea9c5aabfad2fe/ferochercakeslice-1.jpg" class="card-img-top" alt="Product 9">
                    <div class="card-body">
                        <h5 class="card-title">Ferrero Rocher</h5>
                        <p class="card-text">Ferrero Rocher is a popular brand of chocolate confectionery that consists of a whole roasted hazelnut encased in a thin wafer shell filled with hazelnut cream.</p>
                        <p class="card-text"><strong>Price: 0.90Eth</strong></p>
                        <button onclick="buyProduct(9)" class="btn btn-primary">Buy Now</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let account;
        let contractInstance;
    
        // Initialize contract instance with ABI and contract address
        const initContract = () => {
            const contractAddress = '0x6cf04cba382c7774bfb434cae2311a6091631c09'; 
            const contractABI = [
            [
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "buyer",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "productId",
                        "type": "uint256"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "price",
                        "type": "uint256"
                    }
                ],
                "name": "ProductPurchased",
                "type": "event"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "productId",
                        "type": "uint256"
                    }
                ],
                "name": "buyProduct",
                "outputs": [],
                "stateMutability": "payable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "productId",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "price",
                        "type": "uint256"
                    }
                ],
                "name": "setProductPrice",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "productId",
                        "type": "uint256"
                    }
                ],
                "name": "getProductPrice",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "owner",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "name": "productPrices",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ]
            ];
            contractInstance = new web3.eth.Contract(contractABI, contractAddress);
        }
    
        const connectMetamask = async () => {
            try {
                if (window.ethereum !== undefined) {
                    const accounts = await ethereum.request({ method: "eth_requestAccounts" });
                    account = accounts[0];
                    document.getElementById("userArea").innerHTML = `User Account: ${account}`;
                    document.getElementById("userArea").classList.remove('text-muted');
                } else {
                    alert("MetaMask extension not detected. Please install MetaMask and try again.");
                }
            } catch (error) {
                console.error("Error connecting to MetaMask:", error);
                alert("An error occurred while connecting to MetaMask. Please try again later.");
            }
        }
    
        const buyProduct = async (productId) => {
            try {
                // Here you would implement the logic to interact with your smart contract to purchase the product.
                // You can use the account variable to get the currently connected MetaMask account.
                alert(`Product ${productId} purchased successfully by account: ${account}`);
            } catch (error) {
                console.error("Error purchasing product:", error);
                alert("An error occurred while purchasing the product. Please try again later.");
            }
        }
    
        // Initialize contract instance and connect to MetaMask when the page loads
        window.onload = () => {
            if (typeof window.ethereum !== 'undefined') {
                initContract();
                connectMetamask(); // Automatically connect to MetaMask when the page loads
            } else {
                alert("MetaMask extension not detected. Please install MetaMask and try again.");
            }
        };
    </script>
    
    </body>
    </html>